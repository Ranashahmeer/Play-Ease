<div class="booking-page" *ngIf="courtDetails">
  <!-- Header Card -->
  <div class="booking-header-card">
    <div class="booking-image">
      <img [src]="courtDetails.image" alt="{{ courtDetails.name || 'Court' }}" />
      <div class="rating-badge">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2">
          <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
        </svg>
        {{ courtDetails.rating || '-' }}
      </div>
    </div>
    <div class="booking-info">
      <h2>{{ courtDetails.name || 'Court Name' }}</h2>
      <p class="location-line">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
          <circle cx="12" cy="10" r="3"></circle>
        </svg>
        {{ courtDetails.location || 'Location' }}
      </p>
      <p *ngIf="courtDetails.offers?.length">Offers: {{ courtDetails.offers.join(', ') }}</p>
      <p class="price-large">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="1" x2="12" y2="23"></line>
          <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
        </svg>
        Rs {{ getComputedPrice() }}
      </p>
    </div>
  </div>

  <!-- Gallery -->
  <div class="booking-section" *ngIf="courtDetails.images?.length">
    <h3>Gallery</h3>
    <div class="gallery-grid">
      <img *ngFor="let img of courtDetails.images" [src]="img" />
    </div>
  </div>

  <!-- Match Duration -->
  <div class="booking-section">
    <h3>Match Duration</h3>
    <div class="time-slot-grid">
      <div class="time-slot-btn" 
           [class.time-slot-selected]="form.get('matchDuration')?.value===60" 
           (click)="form.patchValue({matchDuration:60}); recomputeAvailability()">
        60 mins
      </div>
      <div class="time-slot-btn" 
           [class.time-slot-selected]="form.get('matchDuration')?.value===90" 
           (click)="form.patchValue({matchDuration:90}); recomputeAvailability()">
        90 mins
      </div>
      <div class="time-slot-btn" 
           [class.time-slot-selected]="form.get('matchDuration')?.value===120" 
           (click)="form.patchValue({matchDuration:120}); recomputeAvailability()">
        120 mins
      </div>
    </div>
  </div>

  <!-- Pitch Selection -->
  <div class="booking-section" *ngIf="courtDetails.pitches?.length">
    <h3>Select Pitch</h3>
    <div class="time-slot-grid">
      <div class="time-slot-btn" 
           *ngFor="let p of courtDetails.pitches"
           [class.time-slot-selected]="selectedPitchSize===p.pitchtype"
           (click)="selectPitch(p)">
        {{ p.pitchtype }}
      </div>
    </div>
  </div>

  <!-- Date Selection -->
<div class="booking-section">
  <h3>Select Date</h3>
  <dx-calendar 
    [(value)]="selectedBookingDate" 
    [min]="minDate"
    (onValueChanged)="onBookingDateChanged($event)">
  </dx-calendar>
</div>

  <!-- Time Slots -->
  <div class="booking-section">
    <h3>Select Time</h3>
    <div class="time-slot-grid">
      <div class="time-slot-btn" *ngFor="let slot of timeSlotItems"
           [class.time-slot-selected]="selectedBookingTime===slot.text"
           [class.disabled]="slot.disabled"
           (click)="!slot.disabled && (selectedBookingTime=slot.text)">
        {{ slot.text }}
      </div>
    </div>
    <p *ngIf="bookedForDay.length>0" class="booked-info">
      <em>Booked for {{ selectedBookingDate | date:'shortDate' }}:</em> {{ bookedForDay.join(', ') }}
    </p>
    <p *ngIf="allSlotsDisabled" class="no-slots">No available slots for this date.</p>
  </div>

  <!-- Proceed to Payment -->
  <button class="next-button" (click)="proceedToPayment()">Proceed to Payment</button>
</div>

<!-- <app-payment-popup [(visible)]="paymentPopupVisible"></app-payment-popup> -->
<!-- court-booking.component.html -->
<app-payment-popup 
  [(visible)]="paymentPopupVisible"
  [bookingData]="bookingData"
  [ownerPaymentMethods]="courtDetails?.paymentMethods || []">
</app-payment-popup>